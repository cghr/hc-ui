(function(q){q.module("scrollable-table",[]).directive("scrollableTable",["$timeout","$q","$parse",function(b,f,k){return{transclude:!0,restrict:"E",scope:{rows:"=watch",sortFn:"="},template:'<div class="scrollableContainer"><div class="headerSpacer"></div><div class="scrollArea" ng-transclude></div></div>',controller:["$scope","$element","$attrs",function(a,c,l){function m(){function a(){0===c.find("table:visible").length?b(a,100):d.resolve()}var d=f.defer();b(a);return d.promise}function n(){c.find("thead th .th-inner").length||
c.find("thead th").wrapInner('<div class="th-inner"></div>');c.find("table th .th-inner").each(function(a,d){d=$(d);var e=d.outerWidth()-d.width(),e=d.parent().width()-e,b=c.find("table th:visible:last");if("center"!==b.css("text-align")){var h=c.find(".scrollArea").height()<c.find("table").height();b[0]==d.parent()[0]&&h&&(e+=c.find(".scrollArea").width()-c.find("tbody tr").width())}d.css("width",e);(e=d.parent().attr("title"))||(e=d.children().length?d.find(".title .ng-scope").html():d.html());
d.attr("title",e.trim())});p.resolve()}this.getSortExpr=function(){return a.sortExpr};this.isAsc=function(){return a.asc};this.setSortExpr=function(c){a.asc=!0;a.sortExpr=c};this.toggleSort=function(){a.asc=!a.asc};this.doSort=function(c){c?a.rows.sort(function(d,b){var g=c(d,b);return a.asc?g:-1*g}):a.rows.sort(function(c,b){var g;var h=a.sortExpr.match(/(.+)\s+as\s+(.+)/),f={};f[h[1]]=c;g=k(h[2])(f);f[h[1]]=b;h=k(h[2])(f);g=g===h?0:g>h?1:-1;return a.asc?g:-1*g})};a.$on("rowSelected",function(a,
b){var e=c.find(".scrollArea table tr[row-id='"+b+"']");1===e.length&&f.all([m(),p.promise]).then(function(){var a=c.find(".headerSpacer").height(),b=c.find(".scrollArea").scrollTop();c.find(".scrollArea").scrollTop(b+e.position().top-a)})});var p=f.defer();$(window).resize(n);a.$watch("rows",function(a,b){a&&m().then(n)});a.asc=!l.hasOwnProperty("desc");a.sortAttr=l.sortAttr;c.find(".scrollArea").scroll(function(a){c.find("thead th .th-inner").css("margin-left",0-a.target.scrollLeft)})}]}}]).directive("sortableHeader",
function(){return{transclude:!0,scope:!0,require:"^scrollableTable",template:'<div ng-mouseenter="enter()" ng-mouseleave="leave()"><div class="title" ng-transclude></div><span class="orderWrapper"><span class="order" ng-show="focused || isActive()" ng-click="toggleSort()"><i ng-show="isAscending()" class="icon-arrow-up"></i><i ng-show="!isAscending()" class="icon-arrow-down"></i></span></span></div>',link:function(b,f,k,a){var c=k.on||"a as a."+k.col;b.isActive=function(){return a.getSortExpr()===
c};b.toggleSort=function(){b.isActive()?a.toggleSort():a.setSortExpr(c);a.doSort(b[k.comparatorFn])};b.isAscending=function(){return b.focused&&!b.isActive()?!0:a.isAsc()};b.enter=function(){b.focused=!0};b.leave=function(){b.focused=!1}}}})})(angular);